# 카프카 정리 6장. 컨슈머 내부 동작

### 컨슈머 오프셋 관리

- 컨슈머의 가장 핵심은 오프셋 관리이다. 오프셋은 카프카에서 메시지의 위치를 나타내는 위치를 오프셋이라한다.
   - 장애가 발생하여 기존 컨슈머대신 새로운 컨슈머가 기존 컨슈머 역할을 대신할경우 기존 컨슈머의 장애발생 메시지 위치부터 가져와야 장애로부터 대응이 빠르다.
   - 오프셋 정보를 __consumer_offsets토픽에 그룹별로 오프셋 정보를 기록.


### __consumer_offsets
- 파티션수와 리플리케이션 팩터수를 가지고 있으며 설정값을 통해 원하는 값으로 변경가능

```
offsets.topic.num.partitions : 기본값 50
offsets.topic.replication.factor : 기본값 3
```

___
### 그룹 코디네이터
- 컨슈머는 하나의 컨슈머 그룹 구성원에 속하며, 그룹내의 컨슈머들은 서로 정보를 공유하며 하나의 공동체로 동작하는 특징이있다.
   - 그룹 내 컨슈머는 그룹에서 떠날수도있고 새롭게 추가될수도 있다.
   - 컨슈머들은 각 작업을 균등하게 분배해야하는데 이러한 동작을 리밸런싱이라한다.

- 컨슈머에도 그룹관리를 위해 코디네이터가 존재, 이를 그룹 코디네이터라 한다.
   - 그룹코디네이터의 목적은 토픽의 파티션, 멤버를 트래킹 하는것이다.
   - 그룹에 컨슈머에 대한 변화가 생기면 작업을 균등하게 재분배하기위해서 컨슈머 리밸런이 발생한다.
   - 그룹 코디네이터는 컨슈머 그룹별로 존재하며 위치는 카프카 클러스터 브로커중 하나에 위치한다.
  


