# 프로듀서의 내부동작 원리와 구현

### 1.프로듀서 동작원리

- 기본적으로 프로듀서가 전송하려는 메세지들은 프로듀서의 send() 메소드를 통해 시리얼라이저, 파티셔너를 거쳐 카프카로 전송하게 된다.

### 2. 파티셔너

- 2-1. 프로듀서는 토픽으로 메세지를 보낼때 해당 토픽의 어느 파티션으로 보내야할지 결정해야하는데 이때사용하는 것이 파티 셔너이다.

- 2-2 파티셔너는 기본적으로 메시지의 키를 해시로 처리해 어느 파티션으로 보내는지 결정한다.

- 2-3. 메시지의 키값이 동일하면 해당메시지들은 모두 같은 파티션으로 전송된다.

- 2-4 메시지의 키를 이용해 메시지를 전송하기 떄문에 되도록이면 파티션수를 변경하지 않는 것을
권장함

![img.png](img.png)

### 라운드 로빈 전략 & 스티키 파티셔닝 전략

#### 라운드 로빈 전략
- 2-1 메시지의 키값은 필수값이 아니므로 null값이 들어올경우는 기본값인 RR알고리즘 전략을 사용하여 레코드를 랜덤 전송합니다.

- 2-2 RR전략은 메시지는 배치전송을위해서 설정한 레코드 전송수를 충족하지못하면 프로듀서 내부에 계속 대기를 해야하는 단점이 있다.

![img_1.png](img_1.png)

#### 스티키 파티셔닝 전략

- 2-3 RR전략의 단점은 보완하여 나온 스티키 파니셔닝 전략으로 하나의 파티션에 레코드 수를 먼저 채워서 빠르게 배치전송하는 전략.
카프카 2.4버전에서부터 출시.

- 2-2 속도 차이가 미미한거 처럼 느낄수있지만 RR로빈 전략보다 30프로이상 지연시간이 감소, 카프카에서는 스티키 파티셔닝 전략을 권장.

![img_2.png](img_2.png)